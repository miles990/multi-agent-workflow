# TASKS Skill 風險緩解策略

> 5 個已識別風險，分層緩解策略

---

## 風險總覽

```
            可能性
        低     中     高
     ┌──────┬──────┬──────┐
  高 │  R3  │ R1,R4│      │
嚴   ├──────┼──────┼──────┤
重   │  R5  │  R2  │      │
度   ├──────┼──────┼──────┤
  低 │      │      │      │
     └──────┴──────┴──────┘
```

---

## R1: PLAN 輸出格式不一致

**嚴重度**：高
**可能性**：中
**影響**：TASKS 階段無法解析 PLAN 輸出

### 根本原因
- PLAN 階段輸出格式未標準化
- 不同視角產出結構不一致

### 緩解策略

| 層級 | 策略 | 實施時間 |
|------|------|----------|
| **預防** | 文件化 PLAN 輸出 schema | M1 |
| **偵測** | 載入時格式驗證 | M1 |
| **容錯** | 缺失欄位使用預設值 | M1 |
| **恢復** | 清晰錯誤訊息指引修正 | M1 |

### 具體措施

```yaml
# config/plan-input-schema.yaml
required_fields:
  - implementation-plan.md
  - milestones.md

optional_fields:
  - risk-mitigation.md

validation:
  on_missing_required: error_with_guidance
  on_missing_optional: warn_and_continue
```

### 監控指標
- PLAN 載入失敗率
- 缺失欄位頻率

---

## R2: 任務粒度不一致

**嚴重度**：中
**可能性**：高
**影響**：任務太粗難以執行，太細浪費管理成本

### 根本原因
- 不同視角對「合適粒度」理解不同
- 缺乏明確的粒度標準

### 緩解策略

| 層級 | 策略 | 實施時間 |
|------|------|----------|
| **預防** | 在視角 prompt 明確定義粒度範圍 | M2 |
| **偵測** | REDUCE 階段粒度檢查 | M2 |
| **警告** | 超出範圍任務標記警告 | M2 |
| **建議** | 提供拆分/合併建議 | M3 |

### 具體措施

```markdown
# 在每個視角 prompt 中包含：

## 任務粒度標準

**目標粒度**：10-60 分鐘可完成

**判斷標準**：
- 少於 10 分鐘 → 考慮合併相關任務
- 超過 60 分鐘 → 必須進一步拆分
- 包含超過 3 個獨立步驟 → 考慮拆分

**例外情況**：
- 環境設置類任務可達 2 小時
- 簡單配置類任務可少於 10 分鐘
```

### 監控指標
- 任務預估時間分布
- 超出範圍任務比例

---

## R3: 循環依賴

**嚴重度**：高
**可能性**：低
**影響**：任務無法排序，Wave 分組失敗

### 根本原因
- 多視角並行產出，可能互相引用
- 缺乏全域依賴檢查

### 緩解策略

| 層級 | 策略 | 實施時間 |
|------|------|----------|
| **預防** | dependency-analyst 先行建立 DAG 框架 | M2 |
| **偵測** | REDUCE 時 DAG 驗證（拓撲排序） | M2 |
| **報告** | 發現循環時顯示循環路徑 | M2 |
| **解決** | 提供手動解決建議 | M2 |

### 具體措施

```yaml
# REDUCE 階段循環檢測邏輯

cycle_detection:
  algorithm: topological_sort
  on_cycle_found:
    action: stop_and_report
    output:
      - cycle_path: [T-F-001, T-F-003, T-F-001]
      - suggestion: "考慮將 T-F-001 與 T-F-003 合併，或重新定義依賴"
```

### 監控指標
- 循環依賴檢測次數
- 循環解決時間

---

## R4: IMPLEMENT 無法消費 tasks.yaml

**嚴重度**：高
**可能性**：中
**影響**：TASKS 產出無法被下游使用

### 根本原因
- tasks.yaml 格式與 IMPLEMENT 期望不符
- IMPLEMENT 尚未更新以消費新格式

### 緩解策略

| 層級 | 策略 | 實施時間 |
|------|------|----------|
| **同步** | 與 IMPLEMENT 更新同步進行 | M3 |
| **相容** | 提供向後相容的轉換層（可選） | M3 |
| **漸進** | 先部分使用，再完全依賴 | M3 |
| **版本** | 維護版本號確保相容性 | M1 |

### 具體措施

```yaml
# tasks.yaml 版本控制

version: "1.0.0"

# IMPLEMENT 消費方式
implement_integration:
  version_1.0:
    - 讀取 tasks.yaml
    - 按 wave 順序執行
    - 更新 status 欄位

  fallback:
    - 直接使用 implementation-plan.md
    - 手動任務管理
```

### 監控指標
- IMPLEMENT 載入成功率
- 版本相容性問題數

---

## R5: 視角衝突無法解決

**嚴重度**：中
**可能性**：低
**影響**：任務定義不一致，執行困惑

### 根本原因
- 多視角對同一功能有不同理解
- REDUCE 邏輯無法自動解決衝突

### 緩解策略

| 層級 | 策略 | 實施時間 |
|------|------|----------|
| **分離** | 使用任務類型前綴區分 | M2 |
| **保留** | 衝突時保留全部，標記 | M2 |
| **人工** | 需要決策時暫停詢問 | M2 |

### 具體措施

```yaml
# 任務類型前綴

task_prefixes:
  T-F-:    # 功能任務 (task-decomposer)
  T-R-:    # 重構任務 (task-decomposer)
  TEST-:   # 測試任務 (test-planner)
  RISK-:   # 風險任務 (risk-preventor)

# 同一功能的多視角任務不衝突，而是互補
# 例如：T-F-001 (實作) + TEST-001 (測試) + RISK-001 (監控)
```

### 監控指標
- 衝突標記數量
- 人工介入頻率

---

## 回退點設計

| 回退點 | 觸發條件 | 動作 | 恢復方式 |
|--------|----------|------|----------|
| **BP-1** | PLAN 載入失敗 | 停止執行 | 修正 PLAN 後重試 |
| **BP-2** | 循環依賴檢測 | 停止執行 | 手動解決循環後重試 |
| **BP-3** | 全部視角失敗 | 回退到 PLAN | 檢查 PLAN 內容後重新規劃 |
| **BP-4** | REDUCE 整合失敗 | 重試一次 | 失敗則停止 |

---

## 風險監控任務

建議在 TASKS 產出中包含以下監控任務：

```yaml
- id: RISK-MONITOR-001
  type: monitoring
  name: "設置 TASKS 階段監控"
  description: |
    監控任務分解品質指標：
    - 任務粒度分布
    - 依賴複雜度
    - 視角衝突率
  priority: P1
  acceptance_criteria:
    - "指標收集點已嵌入"
    - "異常閾值已設定"
```

---

## 風險審查時機

| 時機 | 審查內容 |
|------|----------|
| M1 完成後 | 驗證 schema 可處理 R1、R2 |
| M2 完成後 | 驗證 R3、R5 緩解有效 |
| M3 完成後 | 驗證 R4 整合正常 |
| 首次實際使用後 | 全面風險復盤 |
