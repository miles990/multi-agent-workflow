# Context Freshness Configuration v2.0
# 上下文新鮮機制（簡化版）— 參考 GSD 設計

version: "2.0"

# 核心原則
# =========
# 1. 每個 Task 天生獨立 — Task API 本身就提供新鮮上下文
# 2. 直接注入必要資訊 — 不依賴快照檔案
# 3. Agent 按需讀取 — 需要更多資訊時自己用 Read 工具

# 策略
strategy:
  mode: "inline_injection"  # 直接注入（不產生快照檔案）
  principle: "Task = Fresh Context"

# 為什麼不需要快照檔案？
# =====================
# GSD 的洞察：Claude Code 的 Task API 每次呼叫都是獨立的 context window
# - 不需要「保存」快照，因為沒有共享的 context 需要「重置」
# - 直接在 Task prompt 中注入必要資訊更簡單、更可靠
# - 驗證方式：Task 能完成 = 上下文足夠

# Agent Prompt 組成
prompt_structure:
  # 必須包含（直接注入到 prompt）
  required:
    - role_description      # 角色描述
    - task_objective        # 任務目標
    - focus_areas           # 聚焦領域
    - output_requirements   # 輸出要求
    - output_path           # 輸出檔案路徑

  # 可選包含（視任務需要）
  optional:
    - previous_stage_summary    # 上一階段摘要（1-3 句）
    - critical_decisions        # 關鍵決策（列表）
    - relevant_file_paths       # 相關檔案路徑（不是內容）

  # 絕不包含（Agent 自己讀取）
  never_include:
    - full_file_contents        # 檔案內容
    - previous_reports          # 完整的視角報告
    - conversation_history      # 對話歷史
    - detailed_analysis         # 詳細分析

# Prompt 範本
prompt_template: |
  ## 任務

  你是一位 {role_description}。

  ### 目標
  {task_objective}

  ### 聚焦領域
  {focus_areas}

  ### 背景（精簡）
  {previous_stage_summary}

  ### 相關檔案
  以下檔案可能有用，請使用 Read 工具讀取：
  {relevant_file_paths}

  ### 輸出要求
  {output_requirements}

  ### 輸出路徑
  完成後，將報告寫入：{output_path}

# 驗證方式
validation:
  # Task 完成本身就是驗證
  method: "task_completion"
  indicators:
    - "Task 能正常完成"
    - "輸出檔案被正確寫入"
    - "報告內容符合要求"

# 品質曲線（來自 GSD）
quality_curve:
  "0-30%": "Peak（最佳）"
  "30-50%": "Good"
  "50-70%": "Degrading"
  "70%+": "Poor"

# 因此：每個 Task 從 0% 開始，保持在最佳品質區間
