# Conflict Resolution（共用模組）

> 矛盾解決：分析分歧原因，找出最佳解決方案

## 矛盾類型

### Type A: 觀點矛盾

不同視角對同一問題有不同看法

```
視角 A：「應該使用方案 X」
視角 B：「應該使用方案 Y」
```

### Type B: 建議矛盾

不同視角推薦互斥的解決方案

```
視角 A：「使用工具 X」
視角 B：「使用工具 Y」
```

### Type C: 優先級矛盾

不同視角對重要性排序不同

```
視角 A：「效能 > 可維護性」
視角 B：「可維護性 > 效能」
```

## 解決流程

```
┌─────────────────────────────────────────────────────────────────┐
│  Step 1: 矛盾分類                                                │
│  識別矛盾類型（A/B/C）                                           │
└─────────────────────────────────────────────────────────────────┘
         ↓
┌─────────────────────────────────────────────────────────────────┐
│  Step 2: 根因分析                                                │
│  • 假設不同？                                                    │
│  • 上下文不同？                                                  │
│  • 權重不同？                                                    │
└─────────────────────────────────────────────────────────────────┘
         ↓
┌─────────────────────────────────────────────────────────────────┐
│  Step 3: 解決嘗試                                                │
│  • 嘗試合成解決方案                                              │
│  • 或確定條件式建議                                              │
│  • 或標記需進一步處理                                            │
└─────────────────────────────────────────────────────────────────┘
         ↓
┌─────────────────────────────────────────────────────────────────┐
│  Step 4: 記錄決策                                                │
│  記錄解決方案和理由                                              │
└─────────────────────────────────────────────────────────────────┘
```

## 根因分析

### 常見矛盾原因

| 原因 | 說明 | 解決方向 |
|------|------|---------|
| 假設不同 | 視角基於不同前提 | 明確列出假設 |
| 上下文不同 | 適用場景不同 | 條件式建議 |
| 時間維度 | 短期 vs 長期考量 | 分階段建議 |
| 權重不同 | 優先級評估不同 | 讓用戶決定 |
| 資訊差異 | 某視角有更新資訊 | 以最新為準 |

### 分析問題清單

```markdown
## 矛盾分析：[矛盾 ID]

### 矛盾內容
- 視角 A 說：...
- 視角 B 說：...

### 根因探索
1. 假設差異？
   - A 假設：...
   - B 假設：...

2. 上下文差異？
   - A 適用於：...
   - B 適用於：...

3. 時間維度差異？
   - A 考慮：短期/長期
   - B 考慮：短期/長期

4. 證據強度？
   - A 的支持：...
   - B 的支持：...
```

## 解決策略

### 策略 1: 合成解決

找出兼顧雙方優點的方案

```
矛盾：方案 X vs 方案 Y
合成：結合 X 的優點和 Y 的優點
```

### 策略 2: 條件式建議

根據不同條件給予不同建議

```
矛盾：工具 A vs 工具 B

解決：
- 如果是條件 1 → 工具 A
- 如果是條件 2 → 工具 B
```

### 策略 3: 階段式建議

根據不同階段給予不同建議

```
矛盾：效能優先 vs 可維護性優先

解決：
- 初期階段：可維護性優先（快速迭代）
- 成熟階段：效能優先（規模化）
```

### 策略 4: 標記未解決

如果無法合理解決，明確標記

```
矛盾：關於 X 的最佳實踐

結論：需進一步處理
原因：現有證據不足以判定
建議：進行實際驗證
```

## 多輪分析

對於複雜矛盾，使用多輪 Task 分析：

### Round 1: 深度比較

```
任務：詳細比較視角 A 和 B 的論點

分析：
1. 各自的核心論點
2. 支持證據
3. 潛在弱點
```

### Round 2: 第三方評估

```
任務：從中立角度評估矛盾

考量：
1. 哪方論點更有說服力？
2. 是否有遺漏的考量因素？
3. 最佳妥協方案是什麼？
```

### Round 3: 最終決策

```
任務：產出最終建議

輸出：
1. 推薦方案
2. 決策理由
3. 風險提醒
```

## 配置參數

```yaml
conflict_resolution:
  max_rounds: 3                # 最大分析輪數
  strategies:                  # 可用策略（按優先序）
    - synthesis
    - conditional
    - staged
    - mark_unresolved
  auto_resolve:
    enabled: true
    confidence_threshold: 0.8  # 自動解決的信心閾值
  escalation:
    enabled: true
    after_rounds: 2            # 多少輪後升級
```

## 記錄格式

### 已解決矛盾

```markdown
### 矛盾 #1: [標題]

**衝突視角**
- 視角 A：[觀點]
- 視角 B：[觀點]

**根因**
[分析結果]

**解決方案**
[解決策略 + 具體方案]

**決策依據**
[理由說明]
```

### 未解決矛盾

```markdown
### 矛盾 #2: [標題]

**衝突視角**
- 視角 A：[觀點]
- 視角 B：[觀點]

**根因**
[分析結果]

**狀態**
需進一步處理

**建議行動**
1. [下一步 1]
2. [下一步 2]
```

## 輸出

矛盾解決完成後，更新匯總報告中的「矛盾分析」章節。
